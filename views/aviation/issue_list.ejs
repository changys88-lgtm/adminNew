<%- include('../header') %>

<main class="content">

	<form name="frmSearch" id="frmSearch" enctype="multipart/form-data" method="post" onsubmit="return formSearch(event);" >
	<input type="hidden" name="menuCol"   value="">
    <input type="hidden" name="mode"      value="">
	<input type="hidden" name="page"      value="1">
	<input type="hidden" name="titleData" value="">
		<div id="searchFrame">
			<div class="search_action_bar">
				<div class="search_action_left">
					<span onClick="newReg('','input')"  class="search_action_btn_primary">
						+ 신규등록
					</span>
				</div>
				<div class="search_action_right">
					<input class='custom-control-input' type='checkbox' name='iMode' id='iMode' value='Y'  >
					<span class="unit">보이드제외</span>
					<input name="listCount" type="text" value="15" class="search_action_search_input wh40" placeholder="줄수" />
					<span class="unit">줄수</span>
					<select name="GUCARD" class="search_action_select">
						<option value=""    >카드/현금</option>
						<option value="Card">카드</option>
						<option value="Cash">현금</option>
						<option value="UN"  >미매칭</option>
					</select>
					<select name="GU3" class="search_action_select">
						<option value="A">상태</option>
						<option value="N">발권</option>
						<option value="R">환불</option>
						<option value="V">VOID</option>
						<option value="P">패널티</option>
						<option value="I">재발행</option>
						<option value="E">EMD</option>
					</select>
					<select name="GU1" class="search_action_select">
						<option value=""    >GDS</option>
						<option value="G"   > 갈릴레오</option>
						<option value="A"   > 세이버(애바커스)</option>
						<option value="S"   > 셀커넥(아마데우스)</option>
						<option value="GN"  > 갈릴레오NDC</option>
						<option value="E"   > 이텀</option>
						<option value="NCZ" > NDC CZ</option>
						<option value="ATR" > ATR</option>
						<option value="ATRX"> ATR 제외</option>
					</select>
					<select name="GU6" class="search_action_select">
						<option value="downdate"	>발권일</option>
						<option value="start_day"	>출발일</option>
					</select>
					<input name="start_date" id="start_date" type="text" autocomplete="off" class="search_action_search_input wh100"  onClick="return datePick('start_date')">
					<span class="tilde">~</span>
					<input name="end_date" id="end_date" type="text" autocomplete="off" class="search_action_search_input wh100" onClick="return datePick('end_date')">
					<select name="sFrom" class="search_action_select">
						<option value="e.uid_minor">주문번호</option>
						<option value="a.pnr">PNR</option>
						<option value="pax_name">승객명	</option>
						<option value="a.ticket_number">티켓넘버</option>
						<option value="a.air_line_code">항공사</option>
						<option value="a.site_code">거래처코드</option>
						<option value="c.site_name">거래처명</option>
						<option value="b.city_code">운항구간</option>
					</select>
					<input name="sWord" type="text" value="" class="search_action_search_input" placeholder="검색어를 입력하세요" />
					<button type="submit" class="search_action_icon_btn" aria-label="검색">🔍</button>
				</div>
			</div>

		</div>
	</form>

	<form name="frmForm" method="post" id="frmForm">
	<input type="hidden" name="uid"  value="">
	<input type="hidden" name="mode" value="">
	<div ID="listFrame" >
		<div ID="listFrameSub" class="search-panel">
			<table class='search-table' id='dtBasic'>
				<tr >
                    <th>No</th>
					<th>접수일</th>
					<th>티켓번호</th>
					<th>구분</th>
					<th>승객명</th>
					<th>거래처</th>
					<th>환불금액</th>
					<th>수수료</th>
					<th>Point</th>
					<th>담당자</th>
					<th>지출결의서</th>
					<th>삭제</th>
				</tr>
			</table>
		</div>
	</div>
	</form>
	<div class="action_bar_split">

		<div class="action_area_left">
			&nbsp;
			
		</div>
		<div class="action_area_center" id="pagingHTML">
		</div>
		<div class="action_area_right">			
			<button class="action_btn_download excel" onClick="return excelDown()" >
				<span class="icon">📊</span>
				엑셀 다운로드
			</button>
		</div>
		
	</div>

</main>
<form name="frmModify" id="frmModify" method="post" >
	<input type="hidden" name="mode"		value="">
	<input type="hidden" name="air_line_code">
	<input type="hidden" name="ticket_number">
    <input type="hidden" name="ticket_type">

</form>
<div id="basePopUp" style="display:none"></div>
<script type="text/javascript">
<!--

    async function newReg (mode='input') {
        frmModify.mode.value        = mode;
        LoadingStart ();
        json = await dataSaveSend ('frmModify','/aviation/issueSave');
		title = json.title;
		html  = json.html;
        name  = json.name;
		drawer.open(1200, { title, html  });
        LoadingStop();
	}

    function modTicket (air,tkt,type) {
        frmModify.air_line_code.value = air;
        frmModify.ticket_number.value = tkt;
        frmModify.ticket_type.value   = type;
        newReg ('modify');
    }

	$(document).ready(function() {
		//frmSearch.submit ();
		formSearch (event,'1');
	});

    async function formSearch (e,page=1) {
        if (e) e.preventDefault();
        frmSearch.page.value = page;
		LoadingStart ();
        json = await dataSaveSend ('frmSearch','/aviation/issue_list');
		success = json.success;
		if (success === "ok") {
            const datas  = json.listData;
            const paging = json.pageData;
            $("#listFrameSub").html(datas);
            $("#pagingHTML").html(paging);
			parent.$("#topTitleData").html(`발권데이터 (${json.totalCount})`);
            frmSearch.titleData.value = `발권데이터 (${json.totalCount})`;
		} else {
            newAlert('목록호출중 오류 발생');
		}
		LoadingStop();
        return false;
	};

    async function inputCheck () {
        Obj = document.frmDetail;
		if(Obj.air_line_code.value == ""){
			alert("항공사코드를 입력해 주세요");
        } else if(Obj.ticket_number.value == ""){
			alert("티켓번호를 입력해 주세요");
		} else {
            json = await dataSaveSend ('frmDetail','/aviation/issueSave');
            const success  = json.success;
            const errorMsg = json.errorMsg;
            const uid      = json.uid;
            if (success === "ok") {
                formSearch(event,frmSearch.page.value);
                drawer.close();
            } else {
                newAlert('에러:'+errorMsg);
            }
		}
		return false;
	}
	function issueStart(uid) {
		sFile = "/air/order_detail?uid="+uid;
		OpenWindowA(sFile,"",1,1200,800);
	}
//-->
</script>

<%- include('../footer_log') %>