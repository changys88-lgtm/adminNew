<%- include('../header') %>

<link rel="stylesheet" href="/css/international.css">
<!--page_item--->
<main class="international">
    <!--page_item_top-->
    <form name="frmForm" method="post" id="frmForm" onsubmit="return false">
    <input type="hidden" name = "tmpData" value ="" id = "tmpData"> 
    <input type="hidden" name = "tmpData2" value ="" id = "tmpData2"> 
    <input type="hidden" name="titleData" value="">
    <div id="searchFrame">
        <div class="search_action_bar">
            <div class="search_action_left">
                <div class="search-options">
                    <div class="trip-type">
                        <button class="trip active"  ID="ticketType2" onClick="return typeChange('2')">ì™•ë³µ</button>
                        <button class="trip"  ID="ticketType1" onClick="return typeChange('1')">í¸ë„</button>
                        <button class="trip"  ID="ticketType3" onClick="return typeChange('3')">ë‹¤êµ¬ê°„</button>
                        <label class="direct">
                            <input type="checkbox" name="stopover" value="Y" id="stopover" class="trip"ID="ticketDirect" onClick="return typeChange('1')"> ì§í•­ë§Œì¡°íšŒ
                        </label>
                    </div>
                </div>
            </div>
            <div class="search_action_right">
                <div class="search-actions tool-buttons">
                    <button class="btn teal" onClick="filterShow('detail_option')">ìµœì í™” ê²€ìƒ‰ ì„¤ì • â–¾</button>
                    <button class="btn navy secondary" onClick="ageCheck()">ë‚˜ì´ê³„ì‚°</button>
                    <button class="btn orange secondary" onClick="monthSearch()">ì˜¤ì›”ë³„ë„ê²€ìƒ‰</button>
                    <button class="btn dark secondary" onClick="recentSearch()">ìµœê·¼ê²€ìƒ‰</button>
                </div>
                <%- include("bSearch.inc") %>
                <%- include("age.inc") %>
                <div style="position: relative;">
                    <div id="revPopup" style="display:none; position: absolute; left: -550px; top: 40px; z-index: 9999;"></div>
                </div>
            </div>
        </div>
    </div>

      <!-- ê²€ìƒ‰ë°” -->
      <div class="search-bar">

        <div class="search-item city-select" data-type="from">
          <span class="label">ì¶œë°œë„ì‹œ</span>
          <!-- <strong id="fromText">ì¸ì²œ</strong> -->
          <strong id="departure_name_text">
          <input type="text" class="city-input" name="departure_name" id="departure_name" onClick="cityView('1','0')" onkeyup="autoComplete(this,'1','0')" autocomplete="off" value="ì¸ì²œ" placeholder="ì¶œë°œë„ì‹œ">
          </strong>

        </div>

        <div class="swap">â‡„</div>

        <div class="search-item city-select" data-type="to">
            <span class="label">ë„ì°©ë„ì‹œ</span>
            <!-- <strong id="toText" class="is-placeholder">ë„ì°©ë„ì‹œ</strong> -->
            <strong id="arrive_name_text">
            <input type="text" class="city-input" name="arrive_name" id="arrive_name" onClick="cityView('2','0')" onkeyup="autoComplete(this,'2','0')" autocomplete="off" value="ë„ì°©ë„ì‹œ" placeholder="ë„ì°©ë„ì‹œ">
            </strong>
        </div>

        <div class="search-item date-select" id="openCalendar">
            <span class="label">ì¶œë°œì¼</span>
            <!-- <strong id="departText">2025-12-25 (ëª©)</strong> -->
            <strong class="date-span" id="departure_date_name"  onClick="return generateCalendars('departure_date','CalendarLayer')"></strong>
        </div>

        <div class="search-item date-select" id="openCalendarReturn">
            <span class="label">ê·€êµ­ì¼</span>
            <!-- <strong id="returnText">2025-12-27 (í† )</strong> -->
            <strong class="date-span" id="arrive_date_name"  onClick="return generateCalendars('arrive_date','CalendarLayer')"></strong>
        </div>

        <div class="search-item pax-select" onClick="seatView()">
            <span class="label">ì¸ì›</span>
            <strong id="seat-box">ì„±ì¸ 1</strong>
            <div style="position :relative;">
                <%- include("mem.inc") %>
            </div>
        </div>
        
        <button class="search-btn">ğŸ” ê²€ìƒ‰</button>
      </div>
    </main>
  </div>
</div>
     
<div class="city-layer" id="CityLayer">
    <div class="layer-box city-modal">
        <div class="city-head">
            <strong>ë„ì‹œ ì„ íƒ</strong>
            <button class="close" onClick="$('.city-layer').removeClass('is-open')">Ã—</button>        
        </div>
        <div class="city-body city-body-split">
            <ul class="region-list"></ul>

            <div class="city-list-area">
                <div class="city-list" id="cityData"></div>
                </div>   
            </div>
        </div>
    </div>
    
    <div class='calendar-layer' ID='CalendarLayer'>
        <div class='layer-box'>
            <div class='layer-head'>
                <strong>ë‚ ì§œ ì„ íƒ</strong>
                <button class='close' onClick="calClose ('CalendarLayer')">Ã—</button>
            </div>
            <div class='calendar-layer-data'  ID='CalendarLayerData'>
            </div>
        </div>
    </div>

    <div class='city_search_box' style="display:none;width: 500px;" ID="CitySearchBox">
        <div class='pop_section'>
            <div class='pa815 title_bold'>ë„ì‹œì •ë³´</div>
            <img class='cal_close_img' src='/images/close_img.png'>
        </div>
        <div class='pa15 f13' ID="CitySearchBoxData" style="max-height:260px;overflow-y: auto;">
        </div>
    </div>
         <!--//ì—¬í–‰ì§€ì—­ ì„ íƒ-->
     </div>
     <%- include("filter.inc") %>
     <%- include("form.inc") %> 
     </form>
    
     <div  class="result-panel">
         <!--page_item_content-->
         <div  class="page_item_content page_item_content2">	
             <!--list-wrap-->
             <div class="banner_btn_wrap none">
                 <div class="swiper-button-prev bbw bb_prev" onClick="event.cancelBubble=true;"></div>
                 <div class="swiper-button-next bbw bb_next" style="right:0px !important;"></div>
             </div>
             <div class="list-wrap air_container" id="SearchSub" style="display:none;">
                 <div class="swiper-wrapper">
                    <% for (let ix = 1; ix < 7; ix++) { 
                        const non = ix > 2 ? "none" : "";
                    %>
                       <div class='list-wrap-50 swiper-slide <%= non %>' style='padding-right:1%; ' id='itiRoute_<%= ix %>'>
                           <p class='tit' id='RouteImg<%= ix %>'><img src='/images/departure.png' class='icon_img'>ì—¬ì • <%= ix %></p>
                   
                           <p class='arr_txt'>
                               <span class='preNextButton_<%= ix %> $none' onclick="return prevDaySearch('<%= ix %>')" style='background-color: #3f51b5;padding: 3px 8px; border-radius:4px; margin-right:10px;color:#fff; cursor:pointer;'>ì´ì „ë‚ </span>
                               <span id='airCityName<%= ix %>'>ì¶œë°œì§€ -> ë„ì°©ì§€</span>
                               <span class='preNextButton_<%= ix %> $none' onclick="return nextDaySearch('<%= ix %>')" style='background-color: #3f51b5;padding: 3px 8px; border-radius:4px; margin-left:10px;color:#fff; cursor:pointer;'>ë‹¤ìŒë‚ </span>
                           </p>
                   
                           <div class='info_date'>
                               <span class='s1'><span id='airDateName<%= ix %>'></span></span>
                           </div>
                           <div class='bar'></div>
                           <div class='list__ air-list-form2' id='airListForm<%= ix %>'>
                               <div class='list-roll' id='airListArea<%= ix %>'></div>
                           </div>
                       </div>
                    <% } %>
                 </div>

                 
             </div>

            
                
                
 
 
             
             <div id="MonthData" class="monthArea mat10" style="display:none">
 
             </div>
 
 
 
         </div>
         <!--//page_item_content-->
         
     </div>
     <div>
     <form name='frmAir' onsubmit="return airCheck()">
        <div id="searchFrame">
			<div class="search_action_bar">
                <div class="search_action_left"></div>
                <div class="search_action_right">
                    <span>í•­ê³µì‚¬ ë‰´ìŠ¤</span>
                    <span>í•­ê³µì‚¬</span>
                    <select name="air" class="search-select">
                            <option value=''>ì „ì²´</option>
                            
                        </select>
                        
                        <input type='text' name='word' class='form-smooth wh140'>
                        <span type="submit" class="btn_basic btn_gy" onClick="airCheck ()">ê²€ìƒ‰</span>
                    </div>
                </div>
                
            
 
                
                <div ID="listFrameSub" class="result-panel" >
                    
                </div>
                <div id="pageHTML">
                  
                </div>
            </div>
        </div>
        </form>
        </div>
 
     <!--//air-page-quickbar-->
 
<!--ì˜ˆì•½ìƒì„¸íŒì—…-->
<!-- <div id="detail-popup" style="display:none"></div> -->
 <!--ì˜ˆì•½ìƒì„¸íŒì—…-->
 
 <div class="popup-layer" id="info_popup">
     <div class="content">
         <div class="layer-inner2">
             <img src="../images/close_img.png" class="close_img" alt="íŒì—…ë‹«ê¸°" onClick="$('#info_popup').hide();">
             <div id="info_data" class="info_data" >
 
             </div>
         </div>
     </div>
 </div>
 <div id="basePopUp" style="display:none"></div>
 
         <div id="basePopUp2" style="display:none"></div>
    
 </div>

<div id="basePopUp" style="display:none"></div>
<script type="text/javascript">
<!--

    gData = {};
	searchCnt   = 1;
	totalCnt    = 1;
	docHeight   = 0;
    monthActive = "";
	airActive   = "";
	
	function modalTabClear (name) {
		if (document.getElementById("cabinCheck1").checked == true && name != "cabinCheck1") document.getElementById("cabinCheck1").checked = false ;
		if (document.getElementById("cabinCheck2").checked == true && name != "cabinCheck2") document.getElementById("cabinCheck2").checked = false;
		for (ix = 1 ; ix < 7 ; ix ++) {
			if (document.getElementById("cabinCheck"+ix+"_")) {
                 if (document.getElementById("cabinCheck"+ix+"_").checked == true && name != "cabinCheck"+ix+"_") document.getElementById("cabinCheck"+ix+"_").checked = false;
            }
		}
	}
	

    function resizeFrame() {
        const $mainFrame = parent.$(".mainFrame_on");
        if ($mainFrame.length > 0) {
            const docHeight = $mainFrame.height() - 85;
            $(".main_frame, .search_frame").css("height", docHeight);
        }
    }


	function newsDetail (uid) {
		$("#info_popup").toggle();
        searchDatas ('NEWS',uid);
	}

    function airLikeCheck (code) {
        searchDatas ('airCheck',code);
	}

	function ageCheck () {
        calClose();
        searchDatas ('ageCheck');
	}
    function recentSearch(){
		searchDatas ('recentCheck');
	}
	function calculateAge () {
		start_date  = $("#start_date").val();
		birthday    = $("#birthday").val();
		
		aStart      = start_date.split("-");
		aBirth      = birthday.split("-");

		var age = aStart[0] - aBirth[0];
		// í˜„ì¬ ì›”ê³¼ ìƒì¼ì˜ ì›”ì„ ë¹„êµí•©ë‹ˆë‹¤.
		if (aStart[1] < aBirth[1]) {
			age--;
		}
		// í˜„ì¬ ì›”ê³¼ ìƒì¼ì˜ ì›”ì´ ê°™ì€ ê²½ìš°, í˜„ì¬ ì¼ê³¼ ìƒì¼ì˜ ì¼ì„ ë¹„êµí•©ë‹ˆë‹¤.
		else if (aStart[1] === aBirth[1] && aStart[2] < aBirth[2]) {
			age--;
		}
		$("#ageValue").html(age);
	}

    function firstSet () {
        let date1 = getCookie("AviaSearchDate1");
        let date2 = getCookie("AviaSearchDate2");

        date1 = date1 || getFutureDate(2); // ê¸°ë³¸ 2ì¼ ë’¤
        const week1 = getWeekFromDateStr(date1);
        
        // formì´ ìˆìœ¼ë©´ value ì„¤ì •, ì—†ì–´ë„ í…ìŠ¤íŠ¸ëŠ” í‘œì‹œ
        if (document.frmForm && document.frmForm.departure_date) {
            document.frmForm.departure_date.value = date1;
        }
        $("#departure_date_name").html(CutDate(date1) + " (" + getWeek(week1) + ")");

        date2 = date2 || getFutureDateFrom(date1, 2); // date1 ê¸°ì¤€ 2ì¼ ë’¤
        const week2 = getWeekFromDateStr(date2);
        
        // formì´ ìˆìœ¼ë©´ value ì„¤ì •, ì—†ì–´ë„ í…ìŠ¤íŠ¸ëŠ” í‘œì‹œ
        if (document.frmForm && document.frmForm.arrive_date) {
            document.frmForm.arrive_date.value = date2;
        }
        $("#arrive_date_name").html(CutDate(date2) + " (" + getWeek(week2) + ")");
    }

	$(document).ready(function(){
        resizeFrame();
        searchDatas ("CITY");    
        // ë‚ ì§œ í…ìŠ¤íŠ¸ëŠ” ì¦‰ì‹œ í‘œì‹œ, formì€ ë‚˜ì¤‘ì— ì„¤ì •
        firstSet();
        // formì´ ì™„ì „íˆ ë¡œë“œëœ í›„ value ì¬ì„¤ì •
        setTimeout(function() {
            if (document.frmForm && document.frmForm.departure_date) {
                const date1 = document.frmForm.departure_date.value || getCookie("AviaSearchDate1") || getFutureDate(2);
                const date2 = document.frmForm.arrive_date.value || getCookie("AviaSearchDate2") || getFutureDateFrom(date1, 2);
                document.frmForm.departure_date.value = date1;
                document.frmForm.arrive_date.value = date2;
            }
        }, 200);
	});

    async function searchDatas (mode,uid='') {
        //if (mode == "CITY") {
            const data = 'mode='+mode+'&uid='+uid;
            const res  = await fetch('/searchGet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: data
            });
        //}

        const json  = await res.json();
        if (mode == "CITY") {
            // ë„ì‹œ ë°ì´í„°ë¥¼ íŒŒì‹±í•´ì„œ region-listì™€ city-listë¡œ ë³€í™˜
            // ì„ì‹œ ì»¨í…Œì´ë„ˆì— HTMLì„ ë„£ì–´ì„œ íŒŒì‹±
            const $temp = $('<div>').html(json.city);
            const regionList = [];
            const cityDataByRegion = {};
            
            // ê° ì§€ì—­ë³„ë¡œ ë°ì´í„° ìˆ˜ì§‘
            $temp.find('.list-0').each(function() {
                const $item = $(this);
                const region = $item.find('.city-tit').text().trim();
                if (!region) return;
                
                regionList.push(region);
                const cities = [];
                
                $item.find('ul li a').each(function() {
                    const $link = $(this);
                    const onClick = $link.attr('onClick') || $link.attr('onclick');
                    if (onClick) {
                        const match = onClick.match(/cityChoice\('([^']+)','([^']+)','([^']+)'\)/);
                        if (match) {
                            cities.push({
                                code: match[1],
                                name: match[2],
                                name_en: match[3]
                            });
                        }
                    }
                });
                
                cityDataByRegion[region] = cities;
            });
            
            // ì™¼ìª½ region-list ìƒì„±
            let regionHtml = '';
            regionList.forEach((region, index) => {
                const activeClass = index === 0 ? 'active' : '';
                regionHtml += `<li class="${activeClass}" data-region="${region}">${region}</li>`;
            });
            $('.region-list').html(regionHtml);
            
            // ì˜¤ë¥¸ìª½ city-list ìƒì„± (ì²« ë²ˆì§¸ ì§€ì—­ì˜ ë„ì‹œë“¤)
            const firstRegion = regionList[0];
            if (firstRegion && cityDataByRegion[firstRegion]) {
                let cityHtml = '';
                cityDataByRegion[firstRegion].forEach(city => {
                    cityHtml += `<button type="button" onClick="cityChoice('${city.code}','${city.name}','${city.name_en}')">${city.name}</button>`;
                });
                $('#cityData').html(cityHtml);
            }
            
            // ì§€ì—­ í´ë¦­ ì´ë²¤íŠ¸
            $(document).off('click', '.region-list li').on('click', '.region-list li', function() {
                $('.region-list li').removeClass('active');
                $(this).addClass('active');
                const region = $(this).data('region');
                if (cityDataByRegion[region]) {
                    let cityHtml = '';
                    cityDataByRegion[region].forEach(city => {
                        cityHtml += `<button type="button" onClick="cityChoice('${city.code}','${city.name}','${city.name_en}')">${city.name}</button>`;
                    });
                    $('#cityData').html(cityHtml);
                }
            });
            
            $("#listFrameSub").html(json.news);
            gData = json.cityData;
            
            // ë””ë²„ê¹…ìš© ì½˜ì†” ë¡œê·¸
            console.log('Region List:', regionList);
            console.log('City Data By Region:', cityDataByRegion);
            console.log('First Region Cities:', cityDataByRegion[firstRegion]);
        } else if (mode == "NEWS") {
            $("#info_data").html(json.detail);
        } else if (mode == "airCheck") {
            $("#SearchAirLike").html(json.airData);
            $("#SearchCityLike").html(json.cityData);
        } else if (mode == "ageCheck") {
            smallPopHide ();
            $("#revPopup").show();
            $("#revPopup").html(json.ageData);
        } else if (mode == "recentCheck") {
            $('.moopen').show();
            $("#SearchHistoryArea").html(json.recentData);
        }
	};


    const searchFrameNumber = "<%= searchFrameNumber %>";
    function searchHistory (ticket_type,dep_date,arr_date,src,src_name,dest,dest_name,adt_mem,chd_mem,inf_mem,week1,week2,stopover,addCode,addDate,addWeek,grade) {
		typeChange (ticket_type);
		if (ticket_type == "3") {
			aDate = addDate.split(",");
			aCode = addCode.split(",");
			aWeek = addWeek.split(",");
			currentCity = 1 ;
			currentSub  = 1 ;
			cityChoice(src,src_name);
			currentCity = 2 ;
			currentSub  = 1 ;
			cityChoice(dest,dest_name);
			cabinChangeSingle(1,grade.substring(0,1));

			// ë‘ë²ˆì§¸
			currentCity = 1 ;
			currentSub  = 2 ;
			cityChoice(aCode[0],aCode[1]);

			currentCity = 2 ;
			currentSub  = 2 ;
			cityChoice(aCode[2],aCode[3]);
			cabinChangeSingle(2,grade.substring(1,2));

			if (aCode[4] != "") {
				if (!$("#Route_3").length) addRouting ("+");
				// ì„¸ë²ˆì§¸
				currentCity = 1 ;
				currentSub  = 3 ;
				cityChoice(aCode[4],aCode[5]);

				currentCity = 2 ;
				currentSub  = 3 ;
				cityChoice(aCode[6],aCode[7]);
				//clog('a');
				cabinChangeSingle(3,grade.substring(2,3));

				//clog('b');
			}

			if (aCode[8] != "") {
				if (!$("#Route_4").length) addRouting ("+");
				// ë„¤ë²ˆì§¸
				currentCity = 1 ;
				currentSub  = 4 ;
				cityChoice(aCode[8],aCode[9]);

				currentCity = 2 ;
				currentSub  = 4 ;
				cityChoice(aCode[10],aCode[11]);
				cabinChangeSingle(4,grade.substring(3,4));
			}

			yy = dep_date.substring(0,4);
			mm = dep_date.substring(4,6);
			dd = dep_date.substring(6,8);
			//setInterCal(yy,mm,dd,'dep_date1','frmForm','CalendarLayer','',week1,'','');
            frmForm.dep_date1.value = yy+mm+dd;

			yy = aDate[0].substring(0,4);
			mm = aDate[0].substring(4,6);
			dd = aDate[0].substring(6,8);
			//setInterCal(yy,mm,dd,'dep_date2','frmForm','CalendarLayer','',aWeek[0],'','');
            frmForm.dep_date2.value = yy+mm+dd;

			if (aDate[1] != "") {
				yy = aDate[1].substring(0,4);
				mm = aDate[1].substring(4,6);
				dd = aDate[1].substring(6,8);
				setInterCal(yy,mm,dd,'dep_date3','frmForm','CalendarLayer','',aWeek[1],'','');
                frmForm.dep_date3.value = yy+mm+dd;
			}
			if (aDate[2] != "") {
				yy = aDate[2].substring(0,4);
				mm = aDate[2].substring(4,6);
				dd = aDate[2].substring(6,8);
				setInterCal(yy,mm,dd,'dep_date4','frmForm','CalendarLayer','',aWeek[2],'','');
                frmForm.dep_date4.value = yy+mm+dd;
			}
		} else {
			currentCity = 1 ;
			currentSub  = 0 ;
			cityChoice(src,src_name);
			currentCity = 2 ;
			currentSub  = 0 ;
			cityChoice(dest,dest_name);
			yy = dep_date.substring(0,4);
			mm = dep_date.substring(4,6);
			dd = dep_date.substring(6,8);
			//setInterCal(yy,mm,dd,'departure_date','frmForm','CalendarLayer','',week1,'','');
            frmForm.departure_date.value = yy+mm+dd;
			cabinChangeSingle(1,grade.substring(0,1));

			yy = arr_date.substring(0,4);
			mm = arr_date.substring(4,6);
			dd = arr_date.substring(6,8);
			//setInterCal(yy,mm,dd,'arrive_date','frmForm','CalendarLayer','',week2,'','');
            frmForm.arrive_date.value = yy+mm+dd;
			if (grade.substring(1,2)) cabinChangeSingle(2,grade.substring(1,2));
		}

		if (stopover == "") {
			document.frmForm.stopover.checked = false; 
		} else {
			document.frmForm.stopover.checked = true; 
		}


		document.frmForm.adt.value = adt_mem;
		document.frmForm.chd.value = chd_mem;
		document.frmForm.inf.value = inf_mem;
		memberSet ();
		interSearch ();

		$('.moopen').hide()
	}
	function motionClick (dep,cnt) {
		$("#OpenView"+dep+"_"+cnt).slideDown("fast");
		$("#OpenView"+dep+"2_"+cnt).slideDown("fast");
		$("DepartureBox"+dep+"_"+cnt).toggleClass("fast");
		$('.item-in.item-innn').each(function(index) {
			// Calculating height as (index + 1) * 100%
			var heightValue = (index + 1) * 115 + '%';

			// Generating dynamic CSS to apply
			var dynamicCss = '<style>.item-in.item-innn:nth-of-type(' + (index + 1) + ')::before {height: ' + heightValue + ';}</style>';

			// Appending the dynamic CSS to the head of the document
			$('head').append(dynamicCss);
		});
	}

    function goDetail(day,week){
		
		yy = day.substr(0,4);
		mm = day.substr(4,2);
		dd = day.substr(6);
		tmp = yy+"-"+mm+"-"+dd;

		$("#tmpData").val(tmp);
		$("#tmpData2").val(week);

		let week2 = ['2','3','4','5','6','0','1'];
		set_inter_basic(yy,mm,dd,'departure_date','frmForm','CalendarLayer','',week,tmp,week2[week]);

		interSearch();
	}

//-->
</script>

<div id="smallPopup"  style="display: none;">		
    <div id="smallPopup_arti" >
        <img src="/img/detail_img_closed_gray.png" id="closeBtn" class="wh20 hh20" onClick="smallPopHide ()">
        <div ID="smallPopupData"></div>
    </div>
</div>